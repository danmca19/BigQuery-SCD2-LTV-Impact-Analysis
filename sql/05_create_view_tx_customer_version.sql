CREATE OR REPLACE VIEW `scd2-ltv-analysis.tracking_risco_cliente.tx_with_customer_version` AS SELECT t.*, d.risk_segment, d.valid_from, d.valid_to FROM `scd2-ltv-analysis.tracking_risco_cliente.fact_transactions` t LEFT JOIN `scd2-ltv-analysis.tracking_risco_cliente.dim_customers` d ON t.customer_id=d.customer_id AND t.transaction_date BETWEEN d.valid_from AND COALESCE(d.valid_to,CURRENT_DATE());